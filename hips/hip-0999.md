---
hip: 9999
title: "Wait With kstatus"
authors: [ "@austinabro321" ]
created: "2024-12-06"
type: "feature"
status: "draft"
---

## Abstract

Currently the `--wait` flag on `helm install` and `helm upgrade` does not wait for all resources to be fully reconciled, and does not wait for custom resources (CRs) at all. By replacing the current wait logic with kstatus Helm will achieve *better* waits, while simplifying it's code and documentation. 

## Motivation

Clearly explain why the existing design is inadequate to address the problem
that the HIP solves.

Certain workflows require CRDs to be ready before continuing to the next step. There is no way to tell Helm to wait for custom resources to be ready, so anyone that has this requirement must write their own logic to wait for their custom resources.

Certain workflows may want to wait until their resources are fully reconciled before continuing to their next step. For example, Helm waits for all new pods in an upgraded deployment to be ready. However, Helm does not wait for the previous pods in that deployment to be removed. Ensuring only the new pods are available after waiting for an upgrade can come in handy.

By introducing kstatus we will lower user friction with the `--wait` flag. 

## Rationale

Describe why particular design decisions were made.

## Specification

Describe the syntax and semantics of any new feature.

## Backwards compatibility

Describe potential impact and severity on pre-existing code.

## Security implications

No security implications

## How to teach this

Replace the [existing wait documentation](https://helm.sh/docs/intro/using_helm/) by explaining that we use kstatus and pointing to the [kstatus documentation](https://github.com/kubernetes-sigs/cli-utils/blob/master/pkg/kstatus/README.md). This comes with the added benefit of not needed to maintain Helm specific wait documentation. A separate team has already written extensive documentation on how the wait logic of kstatus works.

## Reference implementation

Link to any existing implementation and details about its state, e.g.
proof-of-concept.

Here is an implementation of waiting for resources using kstatus in a project I maintain called Zarf. I will replace this section with a draft PR showing an example implementation in Helm once I have feedback that this HIP is in the right direction.

## Rejected ideas

Why certain ideas that were brought while discussing this HIP were not
ultimately pursued.

## Open issues

[8661](https://github.com/helm/helm/issues/8661)

## References

A collection of URLs or materials used as references through the HIP.