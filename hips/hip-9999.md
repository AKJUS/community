---
hip: 9999
title: "Enhanced logging library for Helm CLI"
authors: [ "Evans Mungai <mbuevans@gmail.com>" ]
created: "2024-11-22"
type: "feature"
status: "draft"
---

## Abstract

This proposal introduces an improved logging library for Helm CLI to enhance logging capabilities for troubleshooting, development, and debugging. By using newer logging features such as log formatting, different log levels and verbosity levels, developers and CLI users gain flexibility when deciding how much logging information they want to consume, and in what format.

## Motivation

The current logging mechanism in Helm CLI lacks granularity and structure. Users and developers face difficulties when:

- Troubleshooting Helm CLI commands due to inability to increase the details that can get logged. More logs come in handy when submitting bug reports for example.
- Instrumenting code with clear and consistent logging conventions for contributors, as well as consumers of CLI logs.

The proposed solution addresses these gaps by integrating a logging library that supports log levels, verbosity, and structured output.

## Rationale

Two libraries were evaluated:

1. **Go’s `slog`:**
   - Provides log levels (`info`, `debug`, `error`, `warning`).
   - Offers structured logging.
   - Lightweight and straightforward to integrate.
   - Is part of the standard library

2. **`klog`:**
   - Provides log levels and also verbosity levels, enabling more granular control. Verbosity level controls the amount of detail in logs, enabling users to filter messages based on their importance or relevance.
   - Well-aligned with Kubernetes development standards.
   - Allows getting instrumented Kubernetes client library.

While both libraries meet the basic requirements, `klog` offers richer features for developers familiar with Kubernetes' logging patterns, making it the preferred choice for this proposal.

## Specification

- Helm SDK should not be instrumented with error logs. Instead, errors ought to be returned. Any logging of such errors should be left to clients to choose whether to print or not.
- Verbosity levels to enable filtering of logs based on verbosity levels. Lower verbosity levels would be used for major operations in the flow control. __TODO: Should I specify actual numbers or would that be too prescriptive?__
- When invoking plugins and post-renderers, `HELM_LOG_LEVEL` and `HELM_VERBOSITY_LEVEL` environment variables would be set, allowing them to output the appropriate amount of logs to stderr
- Structured logging with two options Raw text for humans to view, and JSON formatting that machines can consume.
- Ability to allow users to configure log levels, verbosity and formatting through CLI flags or environment variables.

### Example:


## Backwards Compatibility

The current logging system, Golang's `log` package will be replaced by `klog`.

## Security Implications


## How to Teach This

1. **Documentation Updates:**
   - Provide examples of using the new logging features in the Helm documentation.
   - Include a section on how to configure verbosity, log levels and formats.
   - Document conventions of how to instrument logs. Specifically, what information should be in what verbosity level.

2. **CLI help text:**
   - Use CLI help messages (`helm --help`) to inform users about the new logging options.

## Reference Implementation


## Rejected Ideas

1. **Sticking with the current logging system:**
   - Rejected due to lack of flexibility and limited usefulness for debugging.

## Open Issues


## References

- [Go’s slog Documentation](https://pkg.go.dev/log/slog)
- [klog Documentation](https://pkg.go.dev/k8s.io/klog/v2)
